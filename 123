<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>充电站地图工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/v4-shims.min.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        accent: '#FF6B6B',
                        warning: '#FFAA33',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <!-- 顶部导航 -->
    <nav class="bg-white/90 backdrop-blur-md shadow-lg fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-map-marker text-primary text-xl"></i>
                <h1 class="text-lg font-bold text-dark">充电站地图工具</h1>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main class="pt-16 pb-8 px-4">
        <!-- 搜索区域 -->
        <div class="max-w-2xl mx-auto mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <div class="flex flex-col space-y-3">
                    <input 
                        type="text" 
                        id="locationInput" 
                        placeholder="输入位置（如：北京市朝阳区）" 
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none"
                    >
                    <div class="flex space-x-2">
                        <select id="radiusSelect" class="flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none">
                            <option value="1">1公里</option>
                            <option value="3" selected>3公里</option>
                            <option value="5">5公里</option>
                        </select>
                        <button id="searchBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-colors">
                            <i class="fa fa-search mr-2"></i>搜索
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 地图区域 -->
        <div class="max-w-4xl mx-auto mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <h2 class="text-lg font-semibold text-dark mb-3">地图视图</h2>
                <div id="mapContainer" class="w-full h-[400px] bg-gray-100 rounded-lg relative overflow-hidden">
                    <!-- 模拟地图 -->
                    <div class="absolute inset-0 bg-gradient-to-br from-green-100 via-blue-100 to-purple-100">
                        <!-- 项目位置 -->
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center border-2 border-white shadow-lg z-10">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                        </div>
                        
                        <!-- 搜索半径 -->
                        <div id="radiusCircle" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border-2 border-primary/30 rounded-full opacity-0 transition-all duration-500"></div>
                        
                        <!-- 充电站标记容器 -->
                        <div id="stationsContainer" class="absolute inset-0 pointer-events-none"></div>
                    </div>
                    
                    <!-- 加载指示器 -->
                    <div id="loadingIndicator" class="absolute inset-0 bg-white/80 flex items-center justify-center z-20 hidden">
                        <div class="flex flex-col items-center">
                            <div class="w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
                            <p class="mt-3 text-gray-600">正在搜索充电站...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 充电站列表 -->
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <h2 class="text-lg font-semibold text-dark mb-3">充电站列表</h2>
                <div id="stationsList" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                    <div class="text-center text-gray-500 py-6">
                        <i class="fa fa-search text-2xl mb-2"></i>
                        <p>请输入位置并点击搜索</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 详细信息模态框 -->
    <div id="stationModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4">
            <div class="p-4">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-semibold text-dark" id="modalTitle">充电站详情</h3>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div id="modalContent" class="space-y-3 text-sm">
                    <!-- 内容将动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 模拟充电站数据
        const mockStations = [
            {
                id: 1,
                name: "国家电网充电站",
                address: "北京市朝阳区建国路88号",
                operator: "国家电网",
                type: "直流快充",
                power: "120kW",
                serviceFee: 0.6,
                electricityFee: 1.2,
                totalFee: 1.8,
                rating: 4.5,
                distance: 0.8,
                available: 8,
                total: 12,
                openTime: "24小时营业"
            },
            {
                id: 2,
                name: "特来电超级充电站",
                address: "北京市朝阳区光华路甲8号",
                operator: "特来电",
                type: "超充",
                power: "360kW",
                serviceFee: 0.8,
                electricityFee: 1.5,
                totalFee: 2.3,
                rating: 4.8,
                distance: 1.2,
                available: 6,
                total: 10,
                openTime: "24小时营业"
            },
            {
                id: 3,
                name: "星星充电服务站",
                address: "北京市朝阳区三里屯路19号",
                operator: "星星充电",
                type: "交流慢充",
                power: "7kW",
                serviceFee: 0.3,
                electricityFee: 1.0,
                totalFee: 1.3,
                rating: 4.2,
                distance: 1.5,
                available: 15,
                total: 20,
                openTime: "06:00-23:00"
            }
        ];

        // DOM元素
        const locationInput = document.getElementById('locationInput');
        const radiusSelect = document.getElementById('radiusSelect');
        const searchBtn = document.getElementById('searchBtn');
        const stationsList = document.getElementById('stationsList');
        const stationsContainer = document.getElementById('stationsContainer');
        const radiusCircle = document.getElementById('radiusCircle');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const stationModal = document.getElementById('stationModal');
        const modalContent = document.getElementById('modalContent');
        const modalTitle = document.getElementById('modalTitle');
        const closeModalBtn = document.getElementById('closeModalBtn');

        // 事件监听
        searchBtn.addEventListener('click', searchStations);
        locationInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchStations();
        });
        closeModalBtn.addEventListener('click', closeModal);
        stationModal.addEventListener('click', function(e) {
            if (e.target === stationModal) closeModal();
        });

        // 搜索充电站
        function searchStations() {
            const location = locationInput.value.trim();
            const radius = parseInt(radiusSelect.value);
            
            if (!location) {
                alert('请输入位置');
                return;
            }
            
            showLoading();
            
            // 模拟API请求延迟
            setTimeout(() => {
                // 显示搜索半径
                updateRadiusCircle(radius);
                
                // 渲染充电站列表
                renderStationsList();
                
                // 渲染地图标记
                renderMapMarkers();
                
                hideLoading();
            }, 1500);
        }

        // 更新搜索半径圈
        function updateRadiusCircle(radius) {
            const mapWidth = document.getElementById('mapContainer').offsetWidth;
            const mapHeight = document.getElementById('mapContainer').offsetHeight;
            
            // 计算半径圈大小
            const radiusSize = radius * 40; // 40px代表1公里
            
            radiusCircle.style.width = `${radiusSize * 2}px`;
            radiusCircle.style.height = `${radiusSize * 2}px`;
            radiusCircle.style.opacity = '1';
        }

        // 渲染充电站列表
        function renderStationsList() {
            stationsList.innerHTML = mockStations.map(station => `
                <div class="bg-gray-50 rounded-lg p-3 hover:bg-gray-100 cursor-pointer transition-all" onclick="showStationDetail(${station.id})">
                    <div class="flex items-start justify-between">
                        <div>
                            <h4 class="font-semibold text-dark">${station.name}</h4>
                            <p class="text-xs text-gray-600 mt-1">${station.address}</p>
                            <div class="flex items-center mt-2 space-x-2">
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded">${station.operator}</span>
                                <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">${station.type}</span>
                                <span class="text-xs text-gray-500">${station.distance}公里</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center justify-end space-x-0.5">
                                ${Array(Math.floor(station.rating)).fill().map(() => '<i class="fa fa-star text-yellow-400 text-xs"></i>').join('')}
                            </div>
                            <p class="text-sm font-medium text-dark mt-1">¥${station.totalFee}/度</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 渲染地图标记
        function renderMapMarkers() {
            stationsContainer.innerHTML = '';
            
            // 生成随机位置的充电站标记
            mockStations.forEach((station, index) => {
                const marker = document.createElement('div');
                marker.className = 'absolute w-5 h-5 bg-primary rounded-full flex items-center justify-center border-2 border-white shadow-md cursor-pointer animate-pulse hover:scale-110 transition-transform';
                
                // 随机位置（围绕中心点）
                const angle = (index / mockStations.length) * Math.PI * 2;
                const distance = Math.random() * 80 + 40; // 40-120px
                const x = 50 + Math.cos(angle) * distance;
                const y = 50 + Math.sin(angle) * distance;
                
                marker.style.left = `${x}%`;
                marker.style.top = `${y}%`;
                marker.setAttribute('data-id', station.id);
                
                // 添加充电站图标
                const icon = document.createElement('div');
                icon.className = 'w-2 h-2 bg-white rounded-full';
                marker.appendChild(icon);
                
                // 添加点击事件
                marker.addEventListener('click', () => showStationDetail(station.id));
                
                stationsContainer.appendChild(marker);
            });
        }

        // 显示充电站详情
        function showStationDetail(stationId) {
            const station = mockStations.find(s => s.id === stationId);
            if (!station) return;
            
            modalTitle.textContent = station.name;
            modalContent.innerHTML = `
                <div class="space-y-2">
                    <div>
                        <p class="text-gray-500">运营商</p>
                        <p class="font-medium">${station.operator}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">地址</p>
                        <p>${station.address}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">充电类型</p>
                        <p class="font-medium">${station.type}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">功率</p>
                        <p>${station.power}</p>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <p class="text-gray-500">服务费</p>
                            <p class="text-primary font-medium">¥${station.serviceFee}/度</p>
                        </div>
                        <div>
                            <p class="text-gray-500">电费</p>
                            <p>¥${station.electricityFee}/度</p>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-500">总计</p>
                        <p class="text-dark font-bold">¥${station.totalFee}/度</p>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <p class="text-gray-500">充电桩数量</p>
                            <p>${station.available}/${station.total} 可用</p>
                        </div>
                        <div>
                            <p class="text-gray-500">营业时间</p>
                            <p>${station.openTime}</p>
                        </div>
                    </div>
                </div>
                <button class="w-full bg-primary hover:bg-primary/90 text-white py-2 rounded-lg mt-4 transition-colors">
                    <i class="fa fa-navigation mr-2"></i>导航到这里
                </button>
            `;
            
            stationModal.classList.remove('hidden');
        }

        // 关闭模态框
        function closeModal() {
            stationModal.classList.add('hidden');
        }

        // 显示加载指示器
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
        }

        // 隐藏加载指示器
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
        }
    </script>
</body>
</html>
