<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>充电站地图工具</title>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=333f6fb91c4ca49187f711ae5649ae6e"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/v4-shims.min.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        accent: '#FF6B6B',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 顶部导航 -->
    <nav class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-map-marker text-primary text-xl"></i>
                <h1 class="text-lg font-bold">充电站地图工具</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button class="text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-question-circle mr-1"></i>帮助
                </button>
                <button class="text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-cog mr-1"></i>设置
                </button>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main class="pt-16 pb-8 px-4">
        <!-- 搜索区域 -->
        <div class="max-w-2xl mx-auto mb-6 mt-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4">查找周边充电站</h2>
                <div class="flex flex-col space-y-4">
                    <input 
                        type="text" 
                        id="locationInput" 
                        placeholder="输入位置（如：北京市朝阳区）" 
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                        value="北京市朝阳区"
                    >
                    <div class="flex space-x-3">
                        <select id="radiusSelect" class="flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all">
                            <option value="1">1公里</option>
                            <option value="3" selected>3公里</option>
                            <option value="5">5公里</option>
                            <option value="10">10公里</option>
                        </select>
                        <button id="searchBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                            <i class="fa fa-search mr-2"></i>搜索充电站
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 数据概览卡片 -->
        <div class="max-w-4xl mx-auto mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-primary">
                    <div class="flex items-center space-x-3">
                        <div class="bg-primary/10 p-3 rounded-lg">
                            <i class="fa fa-charging-station text-primary text-xl"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">充电站总数</p>
                            <p id="totalStations" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-secondary">
                    <div class="flex items-center space-x-3">
                        <div class="bg-secondary/10 p-3 rounded-lg">
                            <i class="fa fa-bolt text-secondary text-xl"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">充电桩总数</p>
                            <p id="totalPiles" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-accent">
                    <div class="flex items-center space-x-3">
                        <div class="bg-accent/10 p-3 rounded-lg">
                            <i class="fa fa-building text-accent text-xl"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">运营商数量</p>
                            <p id="operatorCount" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 地图和筛选区域 -->
        <div class="max-w-7xl mx-auto mb-6">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- 地图区域 -->
                <div class="lg:col-span-3">
                    <div class="bg-white rounded-xl shadow-lg p-4 h-full">
                        <h2 class="text-lg font-semibold mb-3">地图视图</h2>
                        <div id="mapContainer" class="w-full h-[500px] bg-gray-100 rounded-lg relative"></div>
                    </div>
                </div>

                <!-- 筛选面板 -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-4 sticky top-20">
                        <h2 class="text-lg font-semibold mb-4">筛选条件</h2>
                        
                        <div class="space-y-4">
                            <!-- 运营商筛选 -->
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-2">运营商</p>
                                <div id="operatorFilter" class="space-y-2">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="operator-all" class="operator-checkbox w-4 h-4 text-primary" checked>
                                        <label for="operator-all" class="ml-2 text-sm text-gray-700">全部运营商</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 充电类型 -->
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-2">充电类型</p>
                                <div class="space-y-2">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="type-dc" class="type-checkbox w-4 h-4 text-primary" checked>
                                        <label for="type-dc" class="ml-2 text-sm text-gray-700">直流快充</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="type-ac" class="type-checkbox w-4 h-4 text-primary" checked>
                                        <label for="type-ac" class="ml-2 text-sm text-gray-700">交流慢充</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 价格区间 -->
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-2">价格区间</p>
                                <div class="space-y-2">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="price-low" class="price-checkbox w-4 h-4 text-primary" checked>
                                        <label for="price-low" class="ml-2 text-sm text-gray-700">0-1元/度</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="price-medium" class="price-checkbox w-4 h-4 text-primary" checked>
                                        <label for="price-medium" class="ml-2 text-sm text-gray-700">1-2元/度</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="price-high" class="price-checkbox w-4 h-4 text-primary" checked>
                                        <label for="price-high" class="ml-2 text-sm text-gray-700">2元以上/度</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 筛选按钮 -->
                            <button id="filterBtn" class="w-full bg-primary hover:bg-primary/90 text-white py-2 rounded-lg transition-colors">
                                <i class="fa fa-filter mr-1"></i>应用筛选
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 充电站列表和统计图表 -->
        <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- 充电站列表 -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-semibold">充电站列表</h2>
                            <div class="flex space-x-2">
                                <select id="sortSelect" class="px-3 py-1 border border-gray-200 rounded-lg text-sm">
                                    <option value="distance">距离最近</option>
                                    <option value="price">价格最低</option>
                                    <option value="rating">评分最高</option>
                                </select>
                            </div>
                        </div>
                        <div id="stationsList" class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                            <div class="text-center text-gray-500 py-12">
                                <i class="fa fa-search text-3xl mb-3"></i>
                                <p class="text-lg">请点击搜索按钮开始查找充电站</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 统计图表 -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-4 sticky top-20">
                        <h2 class="text-lg font-semibold mb-4">运营商分布</h2>
                        <div id="operatorChart" class="w-full h-[300px]"></div>
                        
                        <div class="mt-6">
                            <h3 class="text-md font-semibold mb-3">充电价格分布</h3>
                            <div id="priceChart" class="w-full h-[200px]"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 加载中遮罩 -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md text-center">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <h3 class="text-xl font-bold mb-2">正在搜索周边充电站</h3>
            <p class="text-gray-600">请稍候，我们正在为您查找附近的充电站信息...</p>
        </div>
    </div>

    <!-- 充电站详情模态框 -->
    <div id="stationModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-xl font-bold"></h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div id="modalContent" class="space-y-4"></div>
        </div>
    </div>

    <script>
        // 全局变量
        let map;
        let placeSearch;
        let markers = [];
        let stationsData = [];
        let operatorChart;
        let priceChart;

        // DOM元素
        const locationInput = document.getElementById('locationInput');
        const radiusSelect = document.getElementById('radiusSelect');
        const searchBtn = document.getElementById('searchBtn');
        const stationsList = document.getElementById('stationsList');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const stationModal = document.getElementById('stationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const closeModal = document.getElementById('closeModal');
        const filterBtn = document.getElementById('filterBtn');
        const sortSelect = document.getElementById('sortSelect');
        const totalStations = document.getElementById('totalStations');
        const totalPiles = document.getElementById('totalPiles');
        const operatorCount = document.getElementById('operatorCount');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，开始初始化...');
            initMap();
            initCharts();
            setupEventListeners();
            console.log('初始化完成');
        });

        // 初始化地图
        function initMap() {
            console.log('开始初始化地图...');
            try {
                // 创建地图实例
                map = new AMap.Map("mapContainer", {
                    zoom: 12,
                    center: [116.405, 39.908],
                    viewMode: '3D'
                });
                
                // 加载地图控件插件
                AMap.plugin(['AMap.Scale', 'AMap.ToolBar'], function() {
                    console.log('地图控件插件加载完成');
                    // 添加比例尺控件
                    map.addControl(new AMap.Scale({
                        position: 'LB'
                    }));
                    // 添加工具栏控件
                    map.addControl(new AMap.ToolBar({
                        position: 'RB'
                    }));
                });
                
                // 初始化POI搜索
                AMap.plugin('AMap.PlaceSearch', function() {
                    console.log('PlaceSearch插件加载完成');
                    placeSearch = new AMap.PlaceSearch({
                        pageSize: 20,
                        pageIndex: 1,
                        types: '150500', // 充电站分类代码
                        map: map
                    });
                });
                
                console.log('地图初始化成功');
            } catch (error) {
                console.error('地图初始化失败:', error);
                alert('地图加载失败，请刷新页面重试');
            }
        }

        // 初始化图表
        function initCharts() {
            console.log('初始化图表...');
            // 运营商分布图表
            operatorChart = echarts.init(document.getElementById('operatorChart'));
            operatorChart.setOption({
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left'
                },
                series: [{
                    name: '运营商分布',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: false,
                    itemStyle: {
                        borderRadius: 10,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: 16,
                            fontWeight: 'bold'
                        }
                    },
                    labelLine: {
                        show: false
                    },
                    data: []
                }]
            });

            // 价格分布图表
            priceChart = echarts.init(document.getElementById('priceChart'));
            priceChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: [{
                    type: 'category',
                    data: ['0-1元', '1-2元', '2元以上'],
                    axisTick: {
                        alignWithLabel: true
                    }
                }],
                yAxis: [{
                    type: 'value'
                }],
                series: [{
                    name: '充电站数量',
                    type: 'bar',
                    barWidth: '60%',
                    data: [0, 0, 0]
                }]
            });
        }

        // 设置事件监听器
        function setupEventListeners() {
            console.log('设置事件监听器...');
            searchBtn.addEventListener('click', searchStations);
            locationInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchStations();
            });
            closeModal.addEventListener('click', () => stationModal.classList.add('hidden'));
            filterBtn.addEventListener('click', applyFilters);
            sortSelect.addEventListener('change', sortStations);
            
            // 点击模态框外部关闭
            stationModal.addEventListener('click', function(e) {
                if (e.target === stationModal) {
                    stationModal.classList.add('hidden');
                }
            });
        }

        // 显示加载状态
        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        // 隐藏加载状态
        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        // 搜索充电站
        function searchStations() {
            console.log('开始搜索充电站...');
            const location = locationInput.value.trim();
            const radius = parseInt(radiusSelect.value);
            
            if (!location) {
                alert('请输入位置');
                return;
            }
            
            showLoading();
            
            // 清空之前的数据
            clearPreviousData();
            
            try {
                // 地理编码获取经纬度
                AMap.plugin('AMap.Geocoder', function() {
                    console.log('Geocoder插件加载完成');
                    var geocoder = new AMap.Geocoder();
                    
                    geocoder.getLocation(location, function(status, result) {
                        console.log('地理编码结果:', status, result);
                        
                        if (status === 'complete' && result.geocodes && result.geocodes.length > 0) {
                            var point = result.geocodes[0].location;
                            map.setCenter(point);
                            map.setZoom(14);
                            
                            // 添加搜索半径圈
                            var circle = new AMap.Circle({
                                center: point,
                                radius: radius * 1000,
                                strokeColor: "#165DFF",
                                strokeWeight: 2,
                                strokeOpacity: 0.3,
                                fillColor: "#165DFF",
                                fillOpacity: 0.1
                            });
                            map.add(circle);
                            
                            // 搜索周边充电站
                            searchNearbyStations(point, radius);
                        } else {
                            hideLoading();
                            console.error('地理编码失败:', status, result);
                            showError('无法找到该位置，请检查输入是否正确');
                        }
                    });
                });
            } catch (error) {
                hideLoading();
                console.error('搜索过程出错:', error);
                showError('搜索过程出错，请稍后重试');
            }
        }

        // 搜索周边充电站
        function searchNearbyStations(point, radius) {
            console.log('搜索周边充电站:', point, radius);
            
            try {
                placeSearch.searchNearBy('充电站', point, radius * 1000, function(status, result) {
                    console.log('POI搜索结果:', status, result);
                    hideLoading();
                    
                    if (status === 'complete' && result.pois && result.pois.length > 0) {
                        stationsData = result.pois;
                        processStationsData();
                        updateUI();
                    } else {
                        console.error('POI搜索失败:', status, result);
                        showError('在该区域未找到充电站');
                    }
                });
            } catch (error) {
                hideLoading();
                console.error('POI搜索出错:', error);
                showError('搜索充电站出错，请稍后重试');
            }
        }

        // 处理充电站数据
        function processStationsData() {
            console.log('处理充电站数据...');
            // 为每个充电站添加模拟数据
            stationsData.forEach(station => {
                // 模拟价格数据
                station.price = (Math.random() * 2 + 0.5).toFixed(2);
                // 模拟充电桩数量
                station.pileCount = Math.floor(Math.random() * 20) + 5;
                // 模拟评分
                station.rating = (Math.random() * 1 + 4).toFixed(1);
                // 模拟运营商
                const operators = ['国家电网', '特来电', '星星充电', '云快充', '小鹏超充'];
                station.operator = operators[Math.floor(Math.random() * operators.length)];
                // 模拟充电类型
                station.chargingTypes = ['直流快充', '交流慢充'];
                if (Math.random() > 0.3) {
                    station.chargingTypes.push('超级快充');
                }
                // 模拟营业时间
                station.businessHours = '24小时营业';
                // 模拟地址
                station.address = station.address || '地址信息不详';
            });
        }

        // 更新UI
        function updateUI() {
            console.log('更新UI...');
            updateStationList();
            updateMarkers();
            updateStatistics();
            updateCharts();
            updateOperatorFilters();
        }

        // 更新充电站列表
        function updateStationList() {
            console.log('更新充电站列表...');
            if (stationsData.length === 0) {
                stationsList.innerHTML = `
                    <div class="text-center text-gray-500 py-12">
                        <i class="fa fa-info-circle text-3xl mb-3"></i>
                        <p class="text-lg">在该区域未找到充电站</p>
                    </div>
                `;
                return;
            }

            stationsList.innerHTML = stationsData.map((station, index) => `
                <div class="border border-gray-100 rounded-lg p-3 hover:shadow-md transition-shadow cursor-pointer station-item" data-index="${index}">
                    <div class="flex items-start space-x-3">
                        <div class="bg-primary/10 p-2 rounded-lg">
                            <i class="fa fa-charging-station text-primary"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <h3 class="font-semibold text-gray-800 truncate">${station.name}</h3>
                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">${station.businessHours}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1 truncate">${station.address}</p>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${station.operator}</span>
                                <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">¥${station.price}/度</span>
                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">${station.pileCount}个桩</span>
                                <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded">★${station.rating}</span>
                            </div>
                            <div class="mt-2 flex space-x-2">
                                ${station.chargingTypes.map(type => `
                                    <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">${type}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // 添加点击事件
            document.querySelectorAll('.station-item').forEach(item => {
                item.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    showStationDetails(index);
                });
            });
        }

        // 更新地图标记
        function updateMarkers() {
            console.log('更新地图标记...');
            // 清除之前的标记
            markers.forEach(marker => map.remove(marker));
            markers = [];

            stationsData.forEach((station, index) => {
                const marker = new AMap.Marker({
                    position: [station.location.lng, station.location.lat],
                    title: station.name,
                    icon: new AMap.Icon({
                        size: new AMap.Size(32, 32),
                        image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                        imageSize: new AMap.Size(32, 32)
                    }),
                    zIndex: 100
                });

                marker.on('click', () => showStationDetails(index));
                map.add(marker);
                markers.push(marker);
            });
        }

        // 更新统计信息
        function updateStatistics() {
            console.log('更新统计信息...');
            totalStations.textContent = stationsData.length;
            
            const totalPilesCount = stationsData.reduce((sum, station) => sum + station.pileCount, 0);
            totalPiles.textContent = totalPilesCount;
            
            const operators = [...new Set(stationsData.map(station => station.operator))];
            operatorCount.textContent = operators.length;
        }

        // 更新图表
        function updateCharts() {
            console.log('更新图表...');
            // 更新运营商分布图表
            const operatorData = {};
            stationsData.forEach(station => {
                operatorData[station.operator] = (operatorData[station.operator] || 0) + 1;
            });

            const operatorChartData = Object.entries(operatorData).map(([name, value]) => ({
                name,
                value
            }));

            operatorChart.setOption({
                series: [{
                    data: operatorChartData
                }]
            });

            // 更新价格分布图表
            const priceRanges = [0, 0, 0];
            stationsData.forEach(station => {
                const price = parseFloat(station.price);
                if (price < 1) {
                    priceRanges[0]++;
                } else if (price < 2) {
                    priceRanges[1]++;
                } else {
                    priceRanges[2]++;
                }
            });

            priceChart.setOption({
                series: [{
                    data: priceRanges
                }]
            });
        }

        // 更新运营商筛选器
        function updateOperatorFilters() {
            console.log('更新运营商筛选器...');
            const operators = [...new Set(stationsData.map(station => station.operator))];
            const operatorFilter = document.getElementById('operatorFilter');
            
            // 保留全选选项
            let filterHTML = `
                <div class="flex items-center">
                    <input type="checkbox" id="operator-all" class="operator-checkbox w-4 h-4 text-primary" checked>
                    <label for="operator-all" class="ml-2 text-sm text-gray-700">全部运营商</label>
                </div>
            `;

            operators.forEach(operator => {
                const id = `operator-${operator.replace(/\s+/g, '-')}`;
                filterHTML += `
                    <div class="flex items-center">
                        <input type="checkbox" id="${id}" class="operator-checkbox w-4 h-4 text-primary" checked>
                        <label for="${id}" class="ml-2 text-sm text-gray-700">${operator}</label>
                    </div>
                `;
            });

            operatorFilter.innerHTML = filterHTML;

            // 添加全选功能
            document.getElementById('operator-all').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.operator-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
            });
        }

        // 显示充电站详情
        function showStationDetails(index) {
            console.log('显示充电站详情:', index);
            const station = stationsData[index];
            if (!station) return;

            modalTitle.textContent = station.name;
            modalContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <img src="https://picsum.photos/seed/${station.id}/600/400" alt="${station.name}" class="w-full h-48 object-cover rounded-lg">
                    </div>
                    <div class="space-y-3">
                        <div>
                            <p class="text-sm text-gray-500">运营商</p>
                            <p class="font-medium">${station.operator}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">地址</p>
                            <p>${station.address}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">营业时间</p>
                            <p>${station.businessHours}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">充电价格</p>
                            <p class="text-lg font-bold text-primary">¥${station.price}/度</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">充电桩数量</p>
                            <p>${station.pileCount}个</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">充电类型</p>
                            <div class="flex flex-wrap gap-2">
                                ${station.chargingTypes.map(type => `
                                    <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">${type}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">设施介绍</p>
                    <p class="text-gray-700">该充电站提供多种充电服务，环境整洁，设施齐全。支持多种支付方式，欢迎使用。</p>
                </div>
                <div class="mt-4 flex space-x-2">
                    <button class="flex-1 bg-primary hover:bg-primary/90 text-white py-2 rounded-lg transition-colors">
                        <i class="fa fa-directions mr-1"></i>导航到这里
                    </button>
                    <button class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded-lg transition-colors">
                        <i class="fa fa-star mr-1"></i>收藏
                    </button>
                </div>
            `;

            stationModal.classList.remove('hidden');
        }

        // 应用筛选
        function applyFilters() {
            console.log('应用筛选...');
            // 这里可以添加筛选逻辑
            alert('筛选功能已应用（演示模式）');
        }

        // 排序充电站
        function sortStations() {
            console.log('排序充电站...');
            const sortType = sortSelect.value;
            
            // 这里可以添加排序逻辑
            alert(`按${sortType === 'distance' ? '距离' : sortType === 'price' ? '价格' : '评分'}排序（演示模式）`);
        }

        // 清空之前的数据
        function clearPreviousData() {
            console.log('清空之前的数据...');
            stationsData = [];
            markers.forEach(marker => map.remove(marker));
            markers = [];
            stationsList.innerHTML = `
                <div class="text-center text-gray-500 py-12">
                    <div class="w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-3"></div>
                    <p class="text-lg">正在搜索充电站...</p>
                </div>
            `;
        }

        // 显示错误信息
        function showError(message) {
            console.log('显示错误信息:', message);
            stationsList.innerHTML = `
                <div class="text-center text-red-500 py-12">
                    <i class="fa fa-exclamation-circle text-3xl mb-3"></i>
                    <p class="text-lg">${message}</p>
                </div>
            `;
        }

        // 窗口大小变化时调整图表
        window.addEventListener('resize', function() {
            if (operatorChart) operatorChart.resize();
            if (priceChart) priceChart.resize();
        });

        console.log('所有脚本加载完成');
    </script>
</body>
</html>
