<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>充电站地图工具</title>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=333f6fb91c4ca49187f711ae5649ae6e"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        accent: '#FF6B6B',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 顶部导航 -->
    <nav class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-map-marker text-primary text-xl"></i>
                <h1 class="text-lg font-bold">充电站地图工具</h1>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main class="pt-16 pb-8 px-4">
        <!-- 搜索区域 -->
        <div class="max-w-2xl mx-auto mb-6 mt-8">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <div class="flex flex-col space-y-3">
                    <input 
                        type="text" 
                        id="locationInput" 
                        placeholder="输入位置（如：北京市朝阳区）" 
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none"
                        value="北京市朝阳区"
                    >
                    <div class="flex space-x-2">
                        <select id="radiusSelect" class="flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none">
                            <option value="1">1公里</option>
                            <option value="3" selected>3公里</option>
                            <option value="5">5公里</option>
                        </select>
                        <button id="searchBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-colors">
                            <i class="fa fa-search mr-2"></i>搜索
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 地图区域 -->
        <div class="max-w-4xl mx-auto mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <h2 class="text-lg font-semibold mb-3">地图视图</h2>
                <div id="mapContainer" class="w-full h-[400px] bg-gray-100 rounded-lg relative"></div>
            </div>
        </div>

        <!-- 充电站列表 -->
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <h2 class="text-lg font-semibold mb-3">充电站列表</h2>
                <div id="stationsList" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                    <div class="text-center text-gray-500 py-6">
                        <i class="fa fa-search text-2xl mb-2"></i>
                        <p>请点击搜索按钮开始查找充电站</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // 全局变量
        let map;
        let placeSearch;

        // DOM元素
        const locationInput = document.getElementById('locationInput');
        const radiusSelect = document.getElementById('radiusSelect');
        const searchBtn = document.getElementById('searchBtn');
        const stationsList = document.getElementById('stationsList');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            setupEventListeners();
        });

        // 初始化地图
        function initMap() {
            // 创建地图实例
            map = new AMap.Map("mapContainer", {
                zoom: 12,
                center: [116.405, 39.908],
                viewMode: '3D'
            });
            
            // 添加地图控件
            map.addControl(new AMap.Scale());
            map.addControl(new AMap.ToolBar());
            
            // 初始化POI搜索
            AMap.plugin('AMap.PlaceSearch', function() {
                placeSearch = new AMap.PlaceSearch({
                    pageSize: 20,
                    pageIndex: 1,
                    types: '150500', // 充电站分类代码
                    map: map,
                    panel: "stationsList"
                });
            });
        }

        // 设置事件监听器
        function setupEventListeners() {
            searchBtn.addEventListener('click', searchStations);
            locationInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchStations();
            });
        }

        // 搜索充电站
        function searchStations() {
            const location = locationInput.value.trim();
            const radius = parseInt(radiusSelect.value);
            
            if (!location) {
                alert('请输入位置');
                return;
            }
            
            // 显示加载状态
            stationsList.innerHTML = `
                <div class="text-center text-gray-500 py-6">
                    <div class="w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-3"></div>
                    <p>正在搜索充电站...</p>
                </div>
            `;
            
            // 地理编码获取经纬度
            AMap.plugin('AMap.Geocoder', function() {
                var geocoder = new AMap.Geocoder();
                geocoder.getLocation(location, function(status, result) {
                    if (status === 'complete' && result.geocodes.length) {
                        var point = result.geocodes[0].location;
                        map.setCenter(point);
                        
                        // 添加搜索半径圈
                        var circle = new AMap.Circle({
                            center: point,
                            radius: radius * 1000,
                            strokeColor: "#165DFF",
                            strokeWeight: 2,
                            strokeOpacity: 0.3,
                            fillColor: "#165DFF",
                            fillOpacity: 0.1
                        });
                        map.add(circle);
                        
                        // 搜索周边充电站
                        placeSearch.searchNearBy('充电站', point, radius * 1000, function(status, result) {
                            if (status === 'complete') {
                                if (result.pois.length === 0) {
                                    stationsList.innerHTML = `
                                        <div class="text-center text-gray-500 py-6">
                                            <i class="fa fa-info-circle text-2xl mb-2"></i>
                                            <p>在该区域未找到充电站</p>
                                        </div>
                                    `;
                                }
                            } else {
                                stationsList.innerHTML = `
                                    <div class="text-center text-red-500 py-6">
                                        <i class="fa fa-exclamation-circle text-2xl mb-2"></i>
                                        <p>搜索失败，请稍后重试</p>
                                    </div>
                                `;
                            }
                        });
                    } else {
                        stationsList.innerHTML = `
                            <div class="text-center text-red-500 py-6">
                                <i class="fa fa-exclamation-circle text-2xl mb-2"></i>
                                <p>无法找到该位置，请检查输入是否正确</p>
                            </div>
                        `;
                    }
                });
            });
        }
    </script>
</body>
</html>
